---
title: Android ç»„ä»¶åŒ– ARouter
date: 2023-03-21 18:54:45
categories: []
tags: ['ç»„ä»¶åŒ–', 'Android', 'æŠ€èƒ½', 'srcard', 'android']
---

> åŸæ–‡åœ°å€ [juejin.cn](https://juejin.cn/post/6844904035003138062)

å‰é¢ä¸¤ç¯‡æ–‡ç« åˆ†åˆ«ä»‹ç»äº† Android ç»„ä»¶åŒ–åŸºç¡€çŸ¥è¯†ä»¥åŠ Android ç»„ä»¶åŒ–è¿‡ç¨‹ Application çš„ç›¸å…³çŸ¥è¯†ï¼Œåœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰å¯ä»¥å…ˆé˜…è¯»ä¸‹é¢ä¸¤ç¯‡æ–‡ç« ï¼š

* [Android ç»„ä»¶åŒ–åŸºç¡€](../1fb05f97cf4037d2eec2f0599f188ff8500faf52)
* [Android ç»„ä»¶åŒ– Application](../8d431f07c8d4c47c4e9646c57f218a9fa1d9864a)

Android ç»„ä»¶åŒ–è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°ä¸åŒ module ä¹‹é—´ç•Œé¢çš„è·³è½¬ä¹Ÿæ˜¯åˆ†å‚é‡è¦çš„ï¼Œå¦‚æœè¦å¯¹è‡ªå·±ç»æ‰‹çš„é¡¹ç›®è¿›è¡Œç»„ä»¶åŒ–æ”¹é€ ï¼ŒARouter æ˜¯ä¸€ä¸ªéå¸¸å®¹æ˜“ä¸Šæ‰‹çš„è·¯ç”±æ¡†æ¶ï¼Œç”±å¤§å‚å¼€å‘å›¢é˜Ÿç»´æŠ¤ï¼Œç›¸ä¿¡è´¨é‡æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚

ARouter æ˜¯ albaba å›¢é˜Ÿå¼€æºçš„ä¸€ä¸ª Android App ç»„ä»¶åŒ–æ”¹é€ çš„ä¸€ä¸ªæ¡†æ¶ï¼Œæ”¯æŒæ¨¡å—ä¹‹é—´çš„è·¯ç”±ã€é€šä¿¡ã€æ‹¦æˆªåŠŸèƒ½ï¼Œç›¸æ¯”åŸç”Ÿè·³è½¬æ¥è¯´æ›´èƒ½é€‚åº”ç»„ä»¶åŒ–å¼€å‘ï¼Œæœ¬æ–‡ä¸»è¦é€šè¿‡å®ä¾‹æ€»ç»“ä¸€ä¸‹ Arouter çš„å¸¸ç”¨åŠŸèƒ½ï¼Œå…·ä½“å¦‚ä¸‹ï¼š

1.  ARouter çš„é…ç½®
2.  åº”ç”¨å†…è·³è½¬
3.  åº”ç”¨å†…æºå¸¦å‚æ•°è·³è½¬
4.  Activity è¿”å›ç»“æœå¤„ç†
5.  é€šè¿‡ Uri è·³è½¬åŠå‚æ•°è§£æ
6.  Module ä¹‹é—´çš„è·³è½¬
7.  æœåŠ¡è°ƒç”¨
8.  æ˜¾ç¤ºæ•ˆæœ
  
  
### ARouter çš„é…ç½®

åœ¨å¯¹åº”çš„ build.gradle æ–‡ä»¶ä¸­é…ç½® ARouter çš„ç›¸å…³ä¾èµ–å¦‚ä¸‹ï¼š

```groovy
android {
    defaultConfig {
        ...
        javaCompileOptions {
            annotationProcessorOptions {
                arguments = [AROUTER_MODULE_NAME: project.getName()]
            }
        }
    }
}

dependencies {
    //apiä¸compileråŒ¹é…ä½¿ç”¨ï¼Œä½¿ç”¨æœ€æ–°ç‰ˆå¯ä»¥ä¿è¯å…¼å®¹
    compile 'com.alibaba:arouter-api:1.5.2'
    annotationProcessor 'com.alibaba:arouter-compiler:1.5.2'
    ...
}
```

å¯ä»¥é€‰æ‹©é…ç½®è·¯ç”±è¡¨è‡ªåŠ¨åŠ è½½ï¼Œåœ¨é¡¹ç›®ä¸‹é¢çš„ build.gradle æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š

```groovy
// è·¯ç”±è¡¨è‡ªåŠ¨åŠ è½½æ’ä»¶
apply plugin: 'com.alibaba.arouter'

buildscript {
    
    repositories {
        google()
        jcenter()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:3.0.1'
        
        //ARouter
        classpath "com.alibaba:arouter-register:1.0.2"
    }
}
```

æ­¤å¤–ï¼Œè¿˜éœ€åœ¨ Application ä¸­åˆå§‹åŒ– ARouterï¼Œå¦‚ä¸‹ï¼š

```java
@Override
public void onCreate() {
    super.onCreate();
    // å¿…é¡»åœ¨åˆå§‹åŒ–ARouterä¹‹å‰é…ç½®
    if (BuildConfig.DEBUG){
        // æ—¥å¿—å¼€å¯
        ARouter.openLog();
        // è°ƒè¯•æ¨¡å¼å¼€å¯ï¼Œå¦‚æœåœ¨install runæ¨¡å¼ä¸‹è¿è¡Œï¼Œåˆ™å¿…é¡»å¼€å¯è°ƒè¯•æ¨¡å¼
        ARouter.openDebug();
    }
    ARouter.init(this);
}
```
  
  
### ARouteråº”ç”¨å†…è·³è½¬

  
ä½¿ç”¨ ARouter è¿›è¡Œåº”ç”¨å†…è·³è½¬éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨è¦è·³è½¬çš„ Activity ä¸Šæ·»åŠ  [@Route](https://link.juejin.cn?target=) æ³¨è§£å³å¯ï¼Œå…·ä½“å¦‚ä¸‹ï¼š
  
```java
// é…ç½®çš„pathè‡³å°‘éœ€è¦ä¸¤çº§ï¼Œå¦‚/xx/xxx
@Route(path = FirstActivity.PATH)
public class FirstActivity extends AppCompatActivity {

    public static final String PATH = "/test/firstActivity";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_first);
    }
}
```
  
ç„¶åä½¿ç”¨ ARouter æä¾›çš„è·³è½¬æ–¹å¼æ¥è¿›è¡Œåº”ç”¨å†…éƒ¨ä¹‹é—´çš„è·³è½¬ï¼Œå…·ä½“å¦‚ä¸‹ï¼š
  
```java
// åº”ç”¨å†…è·³è½¬
ARouter.getInstance()
        .build(FirstActivity.PATH)
        .navigation();
```
<!--SR:!2026-04-26,765,250-->
  
  
### åº”ç”¨å†…æºå¸¦å‚æ•°è·³è½¬

  
ARouter é€šè¿‡ withString ç­‰ä¸€ç³»åˆ— with å¼€å¤´çš„æ–¹æ³•è®¾ç½®ä¸ä¹‹å¯¹åº”çš„å‚æ•°æ¥è¿›è¡Œå‚æ•°ä¼ é€’ï¼Œå…·ä½“å¦‚ä¸‹ï¼š
  
```java
// åº”ç”¨å†…æºå¸¦å‚æ•°è·³è½¬
ARouter.getInstance()
        .build(SecondActivity.PATH)
        .withString(SecondActivity.PARAM, "è¿™æ˜¯è·³è½¬æºå¸¦çš„å‚æ•°")
        .navigation();
```
  
ç„¶åä½¿ç”¨ Intent åœ¨è·³è½¬åˆ°çš„ Activity ä¸­ä½¿ç”¨ Intent è·å–ä¼ é€’è¿‡æ¥çš„å‚æ•°ï¼Œå…·ä½“å¦‚ä¸‹ï¼š
  
```java
@Route(path = SecondActivity.PATH)
public class SecondActivity extends AppCompatActivity {

    public static final String PATH = "/test/secondActivity";
    public static final String PARAM = "param";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_second);

        Intent intent = getIntent();
        if (intent!=null){
            String param = intent.getStringExtra(PARAM);
            Toast.makeText(this, param, Toast.LENGTH_SHORT).show();
        }
    }
}
```
<!--SR:!2026-05-13,772,250-->
  
  
### Activity è¿”å›ç»“æœå¤„ç†

Activity è¿”å›ç»“æœå¤„ç†å’ŒåŸç”Ÿå‡ ä¹ä¸€è‡´ï¼Œå³åœ¨è·³è½¬æ—¶æºå¸¦ requestCodeï¼Œå…·ä½“å¦‚ä¸‹ï¼š

```java
// Activityè¿”å›ç»“æœå¤„ç†
ARouter.getInstance()
        .build(ThreeActivity.PATH)
        .navigation(this, 100);
```

ç„¶åï¼Œåœ¨ Activity è¿”å›çš„æ—¶å€™ä½¿ç”¨ Intent æºå¸¦å‚æ•° setResult å³å¯ï¼Œå…·ä½“å¦‚ä¸‹ï¼š

```java
@Route(path = ThreeActivity.PATH)
public class ThreeActivity extends AppCompatActivity {

    public static final String PATH = "/test/threeActivity";
    public static final String PARAM_RESULT = "param_result";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_three);
        Intent intent = getIntent();
        //setResult
        intent.putExtra(PARAM_RESULT,"è¿™æ˜¯è¿”å›æºå¸¦çš„å‚æ•°");
        setResult(RESULT_OK,intent);
    }
}
```
  
  
### é€šè¿‡ Uri è·³è½¬åŠå‚æ•°è§£æ

  
ARouter è¿˜æ”¯æŒé€šè¿‡ Uri è¿›è¡Œè·³è½¬ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªæ— ç•Œé¢çš„ Activity ç”¨äºç›‘å¬ Scheme äº‹ä»¶ï¼Œç”±è¯¥ Activity è¿›è¡Œç»Ÿä¸€è½¬å‘ Uriï¼Œæ‰€æœ‰çš„ Uri éƒ½è¦é€šè¿‡è¿™é‡Œç„¶åè¿›è¡Œåˆ†å‘è·³è½¬ï¼Œå¯ä»¥å¾ˆå¥½çš„è¿›è¡Œ Uri çš„æ§åˆ¶ï¼Œä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†ä½¿ç”¨ Uri è·³è½¬çš„å®‰å…¨æ€§ï¼Œå®è¡Œä¸€ä¸ªæ— ç•Œé¢çš„ Activiry å¦‚ä¸‹ï¼š
  
```java
public class SchemeFilterActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        Uri uri = getIntent().getData();
        // ç»Ÿä¸€å¤–éƒ¨è·³è½¬çš„Uriï¼Œå®ç°è·¯ç”±å™¨ç»Ÿä¸€åˆ†å‘ï¼Œå‡å°‘åªä¾é Intentå±æ€§åŒ¹é…å¸¦æ¥çš„å®‰å…¨é£é™©
        ARouter.getInstance().build(uri).navigation(this, new NavCallback() {
            @Override
            public void onArrival(Postcard postcard) {
                finish();
            }
        });
    }
}
```
  
åœ¨ AndroidManifest æ–‡ä»¶ä¸­é…ç½® hostã€scheme ä»¥åŠ Actionï¼Œå…·ä½“å¦‚ä¸‹ï¼š
  
```java
<activity android:>
    <intent-filter>
        <data
            android:host="test.manu.com"
            android:scheme="arouter" />

        <action android: />
        <action android: />

        <category android: />
        <category android: />
    </intent-filter>
</activity>
```
  
ç„¶åï¼Œåœ¨ assets æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª html æ–‡ä»¶ï¼Œé€šè¿‡ç‚¹å‡»è·³è½¬é“¾æ¥å®Œæˆ Uri çš„è·³è½¬ï¼Œhtml å†…å®¹å¦‚ä¸‹ï¼š
  
```java
<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title></title>
    </head>
    <body>
        <h2>è·³è½¬æµ‹è¯•</h2>
        <h2>è‡ªå®šä¹‰Scheme</h2>
        <p>
            <!--ä¸å¸¦å‚æ•°-->
            <a href="arouter://test.manu.com/test/fiveActivity">arouter://test111.manu.com/test/fiveActivity</a>
        </p>
        <p>
            <!--æºå¸¦å‚æ•°-->
            <a href="arouter://test.manu.com/test/sixActivity?>arouter://test111.manu.com/test/sixActivity?name=alex&age=18&score={"score":"90","rank":"2"}</a>
        </p>
    </body>
</html>
```
<!--SR:!2024-12-02,470,250-->

å…·ä½“æ•ˆæœæŸ¥çœ‹è¿è¡Œæ•ˆæœå›¾ã€‚
  
ç„¶åï¼Œä½¿ç”¨ WebView åŠ è½½è¯¥ Htmlï¼Œå°±å¯ä»¥è·³è½¬åˆ°å¯¹åº”çš„ Activity äº†ï¼Œä¹Ÿå°±æ˜¯é“¾æ¥ä¸­çš„ fiveActivity å’Œ SixActivityï¼Œä¸¤ä¸ª Activity åˆ†åˆ«å¦‚ä¸‹ï¼š
  
```java
// FiveActivity
@Route(path = FiveActivity.PATH)
public class FiveActivity extends AppCompatActivity {

    public static final String PATH = "/test/fiveActivity";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_five);
    }
}

// SixActivity
@Route(path = SixActivity.PATH)
public class SixActivity extends AppCompatActivity {
    public static final String PATH = "/test/sixActivity";
    
    @Autowired
    public String name;
    
    @Autowired
    public int age;
    
    // å¦‚æœè¦åœ¨Uriä¸­ä¼ é€’è‡ªå®šä¹‰å¯¹è±¡ï¼Œåœ¨å‚æ•°ä¸­è¦ä½¿ç”¨jsonå­—ç¬¦ä¸²(encodeURIè½¬ç )ä¼ é€’ï¼Œ
    // åˆ›å»ºä¸€ä¸ªå®ç°äº†SerializationServiceæ¥å£çš„ç±»å®Œæˆjsonçš„è§£æ
    @Autowired
    public ScoreBean score;
    
    @BindView(R.id.tvData)
    TextView tvData;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_six);
        ButterKnife.bind(this);
        // å‚æ•°è‡ªåŠ¨ä¾èµ–æ³¨å…¥
        ARouter.getInstance().inject(this);
        String info = " + score;
        tvData.setText(info);
        Log.i("SixActivity", info);
    }
}
```
  
  
### Module ä¹‹é—´çš„è·³è½¬

  
ä¸» module å’Œå­ module å’Œå­ module ä¹‹é—´çš„è·³è½¬ä¹Ÿéå¸¸å®¹æ˜“ï¼Œå¦‚ä¸» module è·³è½¬å­ moduleï¼Œå½“ç„¶ä¸» module å’Œå­ module éƒ½åœ¨é…ç½® ARouter æ‰å¯ä»¥è¿›è¡Œè¿›è¡Œè·³è½¬ï¼Œå¯åœ¨ä¸» module ä¸­åˆ›å»ºä¸€ä¸ªæ¥å£ç®¡ç†è¦è·³è½¬çš„å­ module çš„è·¯å¾„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š
  
```java
// ç®¡ç†è·³è½¬è·¯å¾„
public interface Module {
    String MODULE_ONE = "/module1/module-one";
    String MODULE_TWO = "/module2/module-two";
}
```
  
ç„¶åï¼Œç›´æ¥è¿›è¡Œè·³è½¬ï¼Œå…·ä½“å¦‚ä¸‹ï¼š
  
```java
//è·³è½¬Module-one
ARouter.getInstance()
        .build(Module.MODULE_ONE)
        .navigation();
```
<!--SR:!2025-11-19,726,270-->
  
  
### æœåŠ¡è°ƒç”¨

ARouter é‡Œé¢çš„æœåŠ¡è°ƒç”¨ä¸èƒ½å’Œ Android é‡Œé¢çš„ Service ç›¸æ··æ·†ï¼Œ<mark style="background: #83d98fA6;">ARouter çš„é‡Œé¢çš„æœåŠ¡è°ƒç”¨å®é™…ä¸Šæ˜¯å¯¹æŸä¸ªä¸šåŠ¡çš„å°è£…</mark> ï¼Œé€šè¿‡ ARouter è¿™ä¸€å±‚çš„ç»Ÿä¸€å°è£…ï¼Œä½¿å¾—è°ƒç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼Œåªéœ€çŸ¥é“è·¯å¾„å’Œåç§°å°±å¯ä»¥éšæ„è°ƒç”¨ï¼Œå®ç° IProvider åˆ›å»ºä¸€ä¸ª Service å¦‚ä¸‹ï¼š  
```java
@Route(path = "/service/singleService")
public class SingleService implements IProvider {
    public static final String PATH = "/service/singleService";
    private Context mContext;

    //å…·ä½“æœåŠ¡
    public void showMessage() {
        Toast.makeText(mContext, "è¿™æ˜¯å¯¹å¤–æä¾›çš„æœåŠ¡", Toast.LENGTH_SHORT).show();
    }

    @Override
    public void init(Context context) {
        this.mContext = context;
        Log.i("SingleService", "SingleService has init");
    }
}
```
ç„¶åå°±å¯ä»¥è°ƒç”¨äº†ï¼Œè°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š  
```java
// é€šè¿‡æœåŠ¡ç±»classè°ƒç”¨
ARouter.getInstance().navigation(SingleService.class).showMessage();
// é€šè¿‡æœåŠ¡ç±»Pathè°ƒç”¨
((SingleService) ARouter.getInstance()
        .build(SingleService.PATH)
        .navigation())
        .showMessage();
```
æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¾èµ–æ³¨å…¥çš„æ–¹å¼å®ŒæˆæœåŠ¡çš„è°ƒç”¨ï¼Œè¿™ç§æ–¹å¼ä¾¿äºå¤šä¸ªæœåŠ¡è¿›è¡Œç®¡ç†ï¼Œåˆ›å»ºä¸€ä¸ªæœåŠ¡ç®¡ç†ç±»å¦‚ä¸‹ï¼š  
```java
// æœåŠ¡ç®¡ç†ç±»
public class ServiceManage {
    @Autowired
    SingleService singleService;

    public ServiceManage(){
        //é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼è·å–æœåŠ¡
        ARouter.getInstance().inject(this);
    }

    public void getService(){
        singleService.showMessage();
    }
}
```
ç„¶åé€šè¿‡æœåŠ¡ç®¡ç†ç±»è°ƒç”¨å…·ä½“çš„æœåŠ¡å¦‚ä¸‹ï¼š  
```java
//æœåŠ¡ç®¡ç†ï¼Œé€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼è·å–æœåŠ¡
ServiceManage manage = new ServiceManage();
manage.getService();
```
  
  
## å‚è€ƒ

[ARouter ä¸­æ–‡æ–‡æ¡£](https://github.com/alibaba/ARouter/blob/master/README_CN.md)
[ARouterè·¯ç”±è¡¨çš„è‡ªåŠ¨åŠ è½½ï¼ˆå¤šæ¨¡å—ï¼‰](https://blog.csdn.net/ovo2263/article/details/126692637)


{% pullquote mindmap mindmap-md %}
- ğŸ”µ
  - [Android ç»„ä»¶åŒ– Application](../8d431f07c8d4c47c4e9646c57f218a9fa1d9864a)
  - [Android ç»„ä»¶åŒ–åŸºç¡€](../1fb05f97cf4037d2eec2f0599f188ff8500faf52)
{% endpullquote %}