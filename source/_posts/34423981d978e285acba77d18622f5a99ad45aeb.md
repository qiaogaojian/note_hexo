---
title: Python Micromamba + Poetry ç¯å¢ƒç®¡ç†
date: 2024-02-07 10:32:46
categories: ['5.æŠ€èƒ½', 'ç¼–ç¨‹è¯­è¨€', 'Python']
tags: ['python', 'srcard', 'æŠ€èƒ½', 'ç¼–ç¨‹è¯­è¨€', 'Python']
---
  
  
## Micromamba å®‰è£…é…ç½®

1. **ä¸‹è½½åè¿›å…¥å®‰è£…ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š**
**Windows**
```sh
.\micromamba.exe shell init -s powershell

# æˆ–ï¼š-p å‚æ•°è®¾ç½® micromamba çš„ç¯å¢ƒç›®å½•ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤ä¸º $HOME/micromambaï¼Œå’Œ miniconda ç±»ä¼¼
.\micromamba.exe shell init -s powershell -p C:\Your\Root\Prefix
```
**Linux** [^10]
```sh
cd ~

curl -Ls https://micro.mamba.pm/api/micromamba/linux-64/latest | tar -xvj bin/micromamba

eval "$(./bin/micromamba shell hook -s posix)"

./bin/micromamba shell init -s bash -p ~/micromamba  # this writes to your .bashrc file

source ~/.bashrc

micromamba config append channels conda-forge
```
**Fish** 
```sh
sudo apt-add-repository ppa:fish-shell/release-3
sudo apt update
sudo apt install fish

cd ~
./bin/micromamba shell init -s fish -p ~/micromamba  
```

2. **å®‰è£… poetry**
micromamba çš„ poetry éœ€è¦å®‰è£…åœ¨è™šæ‹Ÿç¯å¢ƒé‡Œ, `pip install poetry` å®‰è£…åæ‰§è¡Œ `poetry install` é…ç½® PythonPath

3. **è®¾ç½®å›½å†…é•œåƒ**:[^8]
`vim ~/.condarc`[^9]
```sh
channels: 
  - defaults
show_channel_urls: true
default_channels:
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2
custom_channels:
  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  pytorch-lts: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  deepmodeling: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/
```
<!--SR:!2024-07-02,153,250-->

<mark style="background: #fefe00A6;">windows ç¯å¢ƒä¸‹</mark> å¦‚æœmicromambaæŠ¥é”™ `libmamba Could not solve for environment specs`:
```sh
PS D:\Git\Learn\slideshare-downloader> micromamba create -p ./venv python=3.9
warning  libmamba No 'channels' specified
error    libmamba Could not solve for environment specs
    The following package could not be installed
    â””â”€ python 3.9**  does not exist (perhaps a typo or a missing channel).
critical libmamba Could not solve for environment specs
```
éœ€è¦åœ¨æ‰§è¡Œmicromambaå‘½ä»¤æ—¶æŒ‡å®šchannel
  
ç¬¬ä¸€æ­¥å…ˆæ£€æŸ¥micromambaç¨‹åºæ˜¯å¦å·²åŠ å…¥ç³»ç»Ÿç¯å¢ƒå˜é‡, å¦‚æœæ²¡æœ‰åŠ å…¥, åŠ å…¥åé‡è¯•ã€‚
å¦‚æœè¿˜æ˜¯ä¸è¡Œ, è¿è¡Œå‘½ä»¤æ—¶æ·»åŠ  -c é€‰é¡¹å³å¯
```sh
micromamba create -p ./venv python=3.9 -c conda-forge
```
<!--SR:!2025-04-19,310,250-->

ä½¿ç”¨ conda åˆ›å»º 3.9 python ç¯å¢ƒ:
  
```
# åˆ›å»ºæ—¶æŒ‡å®š venv ç›®å½•
condacp $ micromamba create -p ./venv python=2.7 

# åˆ›å»ºå¹¶å¯¼å…¥ env é…ç½®
condacf $ micromamba env create -f environment.yaml
condacfp $ micromamba env create -f environment.yaml -p ./venv

# å¯¼å‡º env é…ç½®
condaep $ micromamba env export -p ./venv | grep -v "^prefix:" > environment.yaml

# å®‰è£…lib
conda install requests
# å¸è½½lib
conda uninstall requests

# æ›´æ–°package
conda env update --file environment.yaml --prune
# Attention:Â if there is aÂ `name`Â tag with a name other than that of your environment inÂ `local.yml`, the command above will create a new environment with that name. To avoid this, use
condaun $ conda env update -n py3.9 --file environment.yaml --prune
condaup $ conda env update -p ./venv --file environment.yaml --prune
```
<!--SR:!2025-07-18,450,250-->

å¦‚æœ `conda init powershell` å¤±è´¥, æ–°å»º profile.ps1
æ”¾å…¥`$PSHOME` å³ `C:\Windows\System32\WindowsPowerShell\v1.0` ç›®å½•[^3]
```
#region conda initialize
# !! Contents within this block are managed by 'conda init' !!
(& "D:\Program\miniconda3\Scripts\conda.exe" "shell.powershell" "hook") | Out-String | Invoke-Expression
#endregion
```

**é…ç½® conda æº**

é…ç½®æ–‡ä»¶è·¯å¾„ç”¨æˆ·ç›®å½•ä¸‹: `~\.condarc`
```yaml
ssl_verify: false
always_yes: true
channels:
  - defaults
show_channel_urls: true
default_channels:
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2
custom_channels:
  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  pytorch-lts: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud
```
  
  
## Poetry å®‰è£…é…ç½®

<mark style="background: #83d98fA6;">Poetry ä¸‹è½½å¤ªæ…¢äº†, åªé€‚åˆå½“ä¸ªå¯åŠ¨å™¨</mark> 

[Python é¡¹ç›®ç®¡ç†æœ€ä½³å®è·µ Poetry](../acc2d6da5dd37affe3f03e94d2997ae7cd02bc92)

ç¯å¢ƒå˜é‡ï¼š
```sh
C:\Users\qiaog\AppData\Roaming\Python\Scripts
# æˆ–
C:\Users\qiaog\AppData\Roaming\pypoetry\venv\Scripts
```

é…ç½® venv ä¸ºé¡¹ç›®æ–‡ä»¶å¤¹:
```sh
poetry config virtualenvs.create true
poetry config virtualenvs.in-project true
```

```sh
# æŸ¥çœ‹ poetry env
poetry config --list

# ä½¿ç”¨ conda env
conda run --name py3.9 poetry run test.py
```

å®‰è£…é”™è¯¯å‚è€ƒ: [[Poetry add æŠ¥é”™ xxx not found in known hashes]]
  
  
## å¼•ç”¨

- [Essi Alizadeh - A Guide to Python Environment, Dependency and Package Management: Conda + Poetry](https://ealizadeh.com/blog/guide-to-python-env-pkg-dependency-using-conda-poetry/)
- [ä¸€ç¯‡æ–‡ç« å¸¦ä½ ä¸Šæ‰‹Poetryã€Condaä¸Pdmï¼Œè½»æ¾æ­å»ºPythonè™šæ‹Ÿå¤šç‰ˆæœ¬å¤æ‚å¼€å‘ç¯å¢ƒ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/554965293)
- [Pythonå¼€å‘ç¯‡â€”â€”æ„å»ºè™šæ‹ŸPythonå¼€å‘ç¯å¢ƒï¼ˆConda+Poetryï¼‰_Python_DisonTangor_InfoQå†™ä½œç¤¾åŒº](https://xie.infoq.cn/article/59811f15c0cced35582839a40)
[^2]: [Conda update fails with SSL error CERTIFICATE_VERIFY_FAILED - Stack Overflow](https://stackoverflow.com/questions/33699577/conda-update-fails-with-ssl-error-certificate-verify-failed)
- [python - Any conda or pip operation give SSL Error in windows 10 - Stack Overflow](https://stackoverflow.com/questions/55185945/any-conda-or-pip-operation-give-ssl-error-in-windows-10)
- [Conda SSL Error: OpenSSL appears to be unavailable on this machine. OpenSSL is required to download and install packages. Â· Issue #11982 Â· conda/conda Â· GitHub](https://github.com/conda/conda/issues/11982)
- [Site Unreachable](https://stackoverflow.com/questions/42352841/how-to-update-an-existing-conda-environment-with-a-yml-file)
[^3]: [Site Unreachable](https://blog.csdn.net/aaadddmdsf/article/details/127912784)
[^4]: [Fetching Title#ta9t](https://www.anaconda.com/blog/a-faster-conda-for-a-growing-community)
[^5]: [Site Unreachable](https://community.anaconda.cloud/t/condavalueerror-key-solver-is-not-a-known-primitive-parameter/55287)
[^6]: [Fetching Title#i7le](https://aws-pytorch-doc.com/setup/)
[^7]: [ä½¿ç”¨ Micromamba æ›¿æ¢ Miniconda æ›´å¿«é…ç½® Python ç¯å¢ƒ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/622346839)
[^8]: [ubuntä¸‹micromambaçš„å®‰è£… - æ˜é‡‘](https://juejin.cn/post/7287805931382456332)
[^9]: https://blog.csdn.net/DMLong_x/article/details/127511433
[^10]: [Micromamba Installation â€” documentation](https://mamba.readthedocs.io/en/latest/micromamba-installation.html)

**ç›¸å…³ç¬”è®°:**

- [Python é¡¹ç›®ç®¡ç†æœ€ä½³å®è·µ Poetry](../acc2d6da5dd37affe3f03e94d2997ae7cd02bc92)
- [Pytorch + Obsidian + Conda + Cuda æ­å»ºäº¤äº’å¼ç¬”è®°å¼€å‘ç¯å¢ƒ](../b8bc8d6b00b5f8aacbc31724c33dd6ecb004e746)

{% pullquote mindmap mindmap-md %}
- ğŸ”µ
  - [Python é¡¹ç›®ç®¡ç†æœ€ä½³å®è·µ Poetry](../acc2d6da5dd37affe3f03e94d2997ae7cd02bc92)
  - [Pytorch + Obsidian + Conda + Cuda æ­å»ºäº¤äº’å¼ç¬”è®°å¼€å‘ç¯å¢ƒ](../b8bc8d6b00b5f8aacbc31724c33dd6ecb004e746)
{% endpullquote %}