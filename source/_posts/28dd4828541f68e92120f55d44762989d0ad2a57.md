---
title: Android ç»„ä»¶åŒ– Application
date: 2023-03-21 18:54:45
categories: ['5.æŠ€èƒ½', 'Android']
tags: ['srcard', 'android', 'ç»„ä»¶åŒ–']
---

> åŸæ–‡åœ°å€ [juejin.cn](https://juejin.cn/post/6844904031668666376)

[Android ç»„ä»¶åŒ–åŸºç¡€](../3b4772e22e0b7c32dd35ae81cbe686a7e7df3307)ä¸­ç¬¼ç»Ÿçš„æ€»ç»“äº†ä¸€ä¸‹ç»„ä»¶åŒ–å¼€å‘çš„ä¸€äº›åŸºç¡€æ€§é—®é¢˜ï¼Œæœ¬ç¯‡æ–‡ç« ç»§ç»­ç»„ä»¶åŒ–çš„å­¦ä¹ ï¼Œä¸»è¦åˆ†å¦‚ä¸‹ä¸‰ä¸ªæ–¹é¢ä»‹ç»ç»„ä»¶åŒ–ä¸­çš„ Application å¦‚ä¸‹ï¼š

1.  Application çš„ä½œç”¨
2.  åˆå¹¶ Application
3.  åŠ¨æ€é…ç½® Application
  
  
## Application çš„ä½œç”¨

Androuid åº”ç”¨çš„å¯åŠ¨çš„æ—¶å€™æœ€å…ˆå¯åŠ¨çš„å°±æ˜¯ Applicationï¼Œæ¯ä¸ª App è¿è¡Œæ—¶ä»…åˆ›å»ºå”¯ä¸€ä¸€ä¸ª Applicationï¼Œå…¶ç”Ÿå‘½å‘¨æœŸå°±æ˜¯ App çš„ç”Ÿå‘½å‘¨æœŸï¼ŒApplication ä¸­å¸¸ç”¨çš„å›è°ƒæ–¹æ³•å¦‚ä¸‹ï¼š
  
-  **onCreate**ï¼šåˆ›å»ºåº”ç”¨ç¨‹åºæ—¶å›è°ƒï¼Œå›è°ƒæ—¶æœºæ—©äºä»»ä½• Activityã€‚
-  onTerminateï¼šç»ˆæ­¢åº”ç”¨ç¨‹åºæ—¶è°ƒç”¨ï¼Œä¸èƒ½ä¿è¯ä¸€å®šä¼šè¢«è°ƒç”¨ã€‚
-  **onLowmemory**ï¼šå½“åå°åº”ç”¨ç¨‹åºç»ˆæ­¢ï¼Œä½†å‰å°ç”¨ç”¨ç¨‹åºå†…å­˜è¿˜ä¸å¤Ÿæ—¶è°ƒç”¨è¯¥æ–¹æ³•ï¼Œå¯åœ¨è¯¥æ–¹æ³•ä¸­é‡Šæ”¾ä¸€äº›ä¸å¿…è¦çš„èµ„æºæ¥åº”å¯¹è¿™ç§æƒ…å†µã€‚
-  **onConfigurationChanged**ï¼šé…ç½®å‘ç”Ÿå˜åŒ–æ—¶å›è°ƒè¯¥æ–¹æ³•ï¼Œå¦‚æ‰‹æœºå±å¹•æ—‹è½¬ç­‰
-  **onTrimMemory**ï¼šé€šçŸ¥åº”ç”¨çš„ä¸åŒå†…å­˜æƒ…å†µï¼Œä¸‹é¢å†…å­˜çº§åˆ«è¯´æ˜æ¥è‡ª
  
å…¶ä¸­é™„ä¸Šä¸€å¼ æ¥è‡ª **Carson_Ho** æ€»ç»“çš„ onTrimMemory ç›¸å…³å†…å­˜çº§åˆ«çš„è¯´æ˜å¦‚ä¸‹ï¼š
  
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ca6608854f0460db834516d90f20b00~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image)
<!--SR:!2027-02-10,948,250-->

Application ä½œä¸ºæ•´ä¸ª App çš„ä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œå…¶ä½œç”¨å¦‚ä¸‹ï¼š
  
1.  ä½œä¸º App çš„å…¥å£ï¼Œå¯ç”¨æ¥<mark style="background: #fefe00A6;">åˆå§‹åŒ–</mark> åŸºæœ¬é…ç½®ï¼Œå¦‚ç¬¬ä¸‰æ–¹ SDK çš„åˆå§‹åŒ–ã€‚
2.  å¯ä»¥åœ¨ Application ä¸­å®šä¹‰ä¾›<mark style="background: #fefe00A6;">å…¨å±€ä½¿ç”¨çš„å˜é‡</mark> ï¼Œä¸è¿‡å½“åº”ç”¨è¢«å¼ºæ€ä¹‹åæœ‰å¯èƒ½å‡ºç°ç©ºæŒ‡é’ˆçš„é—®é¢˜ï¼Œå¯¼è‡´å†æ¬¡æ‰“å¼€åº”ç”¨çš„æ—¶å€™å´©æºƒï¼Œå¦‚æœç¡®å®šè¦è¿™æ ·ä½¿ç”¨ï¼Œä¸€å®šè¦å¤„ç†å¥½è¿™ç§æƒ…å†µã€‚
3.  å¯ä»¥å€ŸåŠ© Application <mark style="background: #fefe00A6;">ç®¡ç† Activity çš„ç”Ÿå‘½å‘¨æœŸ</mark> çŠ¶æ€ä»¥åŠåˆ¤æ–­åº”ç”¨å¤„äºå‰å°è¿˜æ˜¯åå°ç­‰ï¼Œå¯æ ¹æ®å†…å­˜ä¼˜å…ˆçº§<mark style="background: #fefe00A6;">é™ä½è‡ªèº«åº”ç”¨æ‰€å å†…å­˜</mark> ï¼Œå‡å°è‡ªèº«åº”ç”¨è¢«ç³»ç»Ÿå¼ºæ€çš„å¯èƒ½æ€§ã€‚
<!--SR:!2027-02-07,949,250-->
  
  
## åˆå¹¶ Application

AndroidManifest æ˜¯æ¯ä¸ª Module çš„å£°æ˜é…ç½®æ–‡ä»¶ï¼Œå¯¹åº”çš„åœ¨ç”Ÿæˆä¸€ä¸ª App çš„æ—¶å€™ä¹Ÿåº”è¯¥å¯¹åº”ä¸€ä»½ AndroidManifest æ–‡ä»¶ï¼Œé‚£ä¹ˆåœ¨å¤šä¸ª Module å½¼æ­¤ä¾èµ–çš„æƒ…å†µä¸‹å°±éœ€è¦åˆå¹¶å­ Module çš„ AndroidManifest æ–‡ä»¶å†…å®¹åˆ°ä¸» Module çš„ AndroidManifest æ–‡ä»¶ä¸­ï¼Œæœ€ç»ˆä¼šåœ¨ build ç›®å½•ä¸‹ ç”Ÿæˆæœ€ç»ˆçš„ AndroidManifest æ–‡ä»¶ï¼Œç¼–è¯‘ç”Ÿæˆçš„ AndroidManifest æ–‡ä»¶çš„å…·ä½“è·¯å¾„å‚è€ƒå¦‚ä¸‹ï¼š

```java
app\build\intermediates\manifests\full\debug\AndroidManifest.xml

```

åœ¨åˆå¹¶å­ Modulen çš„ AndroidManifest æ–‡ä»¶æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè¡¥å…¨ use-sdk çš„ä¿¡æ¯ä»¥åŠä¸€äº›æœªè®¾ç½®çš„å±æ€§ï¼Œåœ¨åˆå¹¶åå¦‚ Activity ç­‰ç»„ä»¶ä¸­çš„ name å±æ€§éƒ½ä»¥åŒ…å + æ–‡ä»¶åæ¥æŒ‡å®šã€‚

å…¶ä¸­åœ¨åˆå¹¶ AndroidManifest æ–‡ä»¶è¦å¯¹ Application è¿›è¡Œåˆå¹¶ï¼Œ Application åˆå¹¶è§„åˆ™å¦‚ä¸‹ï¼š

1.  å¦‚æœå­ Module ä¸­æœ‰è‡ªå®šä¹‰çš„ Applicationï¼Œä¸» Module ä¸­æ²¡æœ‰è‡ªå®šä¹‰ Applicationï¼Œåˆ™ä¼šå°†å­ Module ä¸­çš„ Application åˆå¹¶åˆ°æœ€ç»ˆçš„ AndroidManifest æ–‡ä»¶ä¸­ã€‚
2.  å¦‚æœä¸» Module æœ‰è‡ªå®šä¹‰ Applicationï¼Œå­ Module æ²¡æœ‰è‡ªå®šä¹‰çš„ Applicationï¼Œåˆ™ä¼šåœ¨æœ€ç»ˆåˆå¹¶çš„ AndroidManifest æ–‡ä»¶ä¸­ä½¿ç”¨ä¸» Module ä¸­çš„ Applicationã€‚
3.  å¦‚æœå¤šä¸ªå­ Module ä¸­éƒ½è‡ªå®šä¹‰äº† Applicationï¼Œåœ¨è§£å†³å†²çªååˆ™ä¼šåœ¨æœ€ç»ˆåˆå¹¶çš„ AndroidManifest æ–‡ä»¶ä¸­ä½¿ç”¨æœ€åç¼–è¯‘çš„ Module ä¸­çš„ Applicationã€‚
4.  å¦‚æœä¸» Module ä¸­æœ‰è‡ªå®šä¹‰çš„ Applicationï¼Œå­ Module ä¸­ä¹Ÿæœ‰è‡ªå®šä¹‰çš„ Applicationï¼Œæ­¤æ—¶ä¼šæç¤ºè¦åœ¨ä¸» Module çš„ AndroidManifest æ–‡ä»¶ä¸­æ·»åŠ  tools:replace å±æ€§ï¼Œç¼–è¯‘å®Œæˆä¹‹åï¼Œåˆå¹¶åçš„ AndroidManifest æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ä¸» Module ä¸­è‡ªå®šä¹‰çš„ Applicationã€‚

åœ¨åˆå¹¶è¿‡ç¨‹ä¸­å¦‚æœä¸æ·»åŠ  tools:replace å±æ€§ï¼Œåˆ™ä¼šæç¤ºæ·»åŠ  tools:android å±æ€§ï¼Œæç¤ºçš„é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š
  
```java
Manifest merger failed : Attribute application@name value=(com.manu.module_one.OneApplication) from [:moduel_one] AndroidManifest.xml:13:9-58
	is also present at [:module_two] AndroidManifest.xml:13:9-58 value=(com.manu.module_two.TwoApplication).
	Suggestion: add 'tools:replace="android:name"' to <application> element at AndroidManifest.xml:6:5-21:19 to override.

```
  
æ¯”å¦‚è¿™é‡Œå°±è¦åœ¨==å­ Module ä¸­==çš„ AndroidManifest æ–‡ä»¶çš„ application æ ‡ç­¾ä¸‹æ·»åŠ  tools:replace å±æ€§ï¼š
  
```java
tools:replace="android:name"

```
<!--SR:!2024-12-01,468,250-->
  
  
## åŠ¨æ€é…ç½® Application

é™¤äº† Application éœ€è¦åˆå¹¶ä¹‹å¤–ï¼Œåœ¨ç»„ä»¶åŒ–è¿‡ç¨‹ä¸­å„ä¸ª Module çš„åˆå§‹åŒ–ä¹Ÿéå¸¸é‡è¦ï¼Œå¯ä»¥ä½¿ç”¨åå°„å®Œæˆå„ä¸ª Module çš„åˆå§‹åŒ–ï¼Œå°±æ˜¯åœ¨ä¸» Module ä¸­åå°„è·å–å­ Module çš„åˆå§‹åŒ–å¯¹è±¡ï¼Œç„¶åè°ƒç”¨å…¶åˆå§‹åŒ–æ–¹æ³•ï¼Œä¸ºäº†æ–¹ä¾¿å®šä¹‰ä¸€ä¸ªç±»ç®¡ç†å­ Module çš„åˆå§‹åŒ–ç±»ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š

```java

public class ModuleConfig {
    private static final String moduleOneInit = "com.manu.module_one.ModuleOneAppInit";
    private static final String moduleTwoInit = "com.manu.module_two.ModuleTwoAppInit";
    public static String[] moduleInits = {
            moduleOneInit,
            moduleTwoInit
    };
}

```

åˆ›å»ºä¸€ä¸ªåˆå§‹åŒ–çš„åŸºç±»æ¥å£å¦‚ä¸‹ï¼š

```java


public interface BaseAppInit {
    /**
     * é«˜ä¼˜å…ˆçº§è¢«åˆå§‹åŒ–
     * @param application
     * @return
     */
    boolean onInitHighPriority(Application application);

    /**
     * ä½ä¼˜å…ˆçº§è¢«åˆå§‹åŒ–
     * @param application
     * @return
     */
    boolean onInitLowPriority(Application application);
}

```

ä¸ºäº†ä½¿å¾—æ¯ä¸ªå­ Module éƒ½èƒ½æ–¹ä¾¿ä½¿ç”¨è¯¥åˆå§‹åŒ–åŸºç±»ï¼Œåº”å°†å…¶æ”¾åœ¨åŸºç±» Module ä¸­ï¼Œå› ä¸ºåŸºç±»è¢«æ‰€æœ‰çš„ Module æ‰€ä¾èµ–ï¼Œç„¶ååœ¨æ¯ä¸ªå­— Module ä¸­ç»§æ‰¿ BaseAppInit å®ç°è‡ªå·± Module çš„åˆå§‹åŒ–ç±»ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š

```java


public class ModuleOneAppInit implements BaseAppInit {
    private static final String TAG = ModuleOneAppInit.class.getSimpleName();

    @Override
    public boolean onInitHighPriority(Application application) {
        Log.i(TAG, "ModuleOneAppInit---onInitHighPriority");
        return true;
    }

    @Override
    public boolean onInitLowPriority(Application application) {
        Log.i(TAG, "ModuleOneAppInit---onInitLowPriority");
        return true;
    }
}

```

æœ€ååœ¨ä¸» Module çš„è‡ªå®šä¹‰çš„ Application ä¸­é€šè¿‡åå°„åˆ›å»ºå„ä¸ªå­ Module çš„åˆå§‹åŒ–ç±»å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶åˆå§‹åŒ–æ–¹æ³•ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š

```java
/**
 * é«˜ä¼˜å…ˆçº§åˆå§‹åŒ–
 */
private void initModuleHighPriority(){
    for (String init: ModuleConfig.moduleInits){
        try {
            Class<?> clazz = Class.forName(init);
            BaseAppInit appInit = (BaseAppInit) clazz.newInstance();
            appInit.onInitHighPriority(this);
        } catch (ClassNotFoundException | IllegalAccessException | InstantiationException e) {
            e.printStackTrace();
        }
    }
}

/**
 * ä½ä¼˜å…ˆçº§åˆå§‹åŒ–
 */
private void initModuleLowPriority(){
    for (String init: ModuleConfig.moduleInits){
        try {
            Class<?> clazz = Class.forName(init);
            BaseAppInit appInit = (BaseAppInit) clazz.newInstance();
            appInit.onInitLowPriority(this);
        } catch (ClassNotFoundException | IllegalAccessException | InstantiationException e) {
            e.printStackTrace();
        }
    }
}

```

è¿è¡Œæ—¥å¿—å¦‚ä¸‹ï¼š

```java
ModuleOneAppInit---onInitHighPriority 
ModuleTwoAppInit---onInitHighPriority
ModuleOneAppInit---onInitLowPriority
ModuleTwoAppInit---onInitLowPriority

```

æ­¤å¤–ï¼Œè¿˜å¯ä»¥åœ¨åŸºç±» Module ä¸­åˆ›å»ºåˆå§‹åŒ–åŸºç±»å’Œ BaseApplicationï¼Œç„¶ååœ¨ BaseApplication ä¸­åå°„è°ƒç”¨è°ƒç”¨å…·ä½“çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå½’æ ¹ç»“åº•è¿˜æ˜¯ä½¿ç”¨åå°„ï¼Œåªæ˜¯å¦ä¸€ç§å®ç°æ–¹å¼ï¼Œé¦–å…ˆåœ¨åŸºç±» moddule ä¸­åˆ›å»º BaseAppInit å¦‚ä¸‹ï¼š

```java

public abstract class BaseAppInit {

    private Application mApplication;

    public BaseAppInit() {
    }

    public void setApplication(@NonNull Application application) {
        this.mApplication = application;
    }

    public void onCreate(){}

    public void OnTerminate(){}

    public void onLowMemory(){}

    public void configurationChanged(Configuration configuration){}
}

```

åœ¨åŸºç±» Module ä¸­åˆ›å»º BaseApplication å¦‚ä¸‹ï¼š

```java


public abstract class BaseApplication extends Application {

    private List<Class<? extends BaseAppInit>> classInitList = new ArrayList<>();
    private List<BaseAppInit> appInitList = new ArrayList<>();

    @Override
    public void onCreate() {
        super.onCreate();
        appInit();
        initCreate();
    }

    protected abstract void appInit();

    protected void registerApplicationInit(Class<? extends BaseAppInit> classInit) {
        classInitList.add(classInit);
    }

    private void initCreate() {
        for (Class<? extends BaseAppInit> classInit : classInitList) {
            try {
                BaseAppInit appInit = classInit.newInstance();
                appInitList.add(appInit);
                appInit.onCreate();

            } catch (InstantiationException | IllegalAccessException e) {
                e.printStackTrace();
            }
        }
    }

    @Override
    public void onTerminate() {
        super.onTerminate();
        for (BaseAppInit appInit : appInitList) {
            appInit.OnTerminate();
        }
    }

    @Override
    public void onLowMemory() {
        super.onLowMemory();
        for (BaseAppInit appInit : appInitList) {
            appInit.onLowMemory();
        }
    }

    @Override
    public void onConfigurationChanged(Configuration newConfig) {
        super.onConfigurationChanged(newConfig);
        for (BaseAppInit appInit : appInitList) {
            appInit.configurationChanged(newConfig);
        }
    }
}

```

ç„¶ååœ¨å­ Module ä¸­å®ç°å…·ä½“çš„åˆå§‹åŒ–ç±»ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š

```java


public class ModuleThreeAppInit extends BaseAppInit {
    private static final String TAG = ModuleThreeAppInit.class.getSimpleName();

    @Override
    public void onCreate() {
        Log.i(TAG, "ModuleThreeAppInit---onCreate");
    }
}

```

æœ€åï¼Œåœ¨ä¸» Module ä¸­ç»§æ‰¿ BaseApplication å®ç°è‡ªå®šä¹‰çš„ Applicationï¼Œå¹¶æ³¨å†Œæ¯ä¸ªå­— Module çš„åˆå§‹åŒ–æ–‡ä»¶ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š

```java


public class MApplication extends BaseApplication{
    @Override
    protected void appInit() {
        registerApplicationInit(ModuleThreeAppInit.class);
        registerApplicationInit(ModuleForeAppInit.class);
    }
}

```

è¿è¡Œæ—¥å¿—å¦‚ä¸‹ï¼š

```java
ModuleThreeAppInit---onCreate
ModuleForeAppInit---onCreate

```

å¦‚ä¸Šä¸¤ç§æ–¹å¼éƒ½æ˜¯ä½¿ç”¨äº†åå°„ï¼Œåå°„åœ¨è§£è€¦çš„åŒæ—¶ï¼Œä¹Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†åº”ç”¨çš„æ€§èƒ½ï¼Œå½“ç„¶ç»„ä»¶åŒ–çš„ç›®çš„å°±æ˜¯è¦è®©å„ä¸ªç»„ä»¶æˆ–å„ä¸ª Module ä¹‹é—´å°½å¯èƒ½çš„è§£è€¦ï¼Œå¦‚æœç‰ºç‰²ä¸€ç‚¹å„¿æ€§èƒ½ï¼Œèƒ½å¤Ÿè·å–è§£è€¦çš„æœ€å¤§åŒ–ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚


**Backlinks:**

- [Android ç»„ä»¶åŒ– ARouter](../8abe118f14be78884377a6dfc907d6cf95994120)

{% pullquote mindmap mindmap-md %}
- ğŸ”µ
  - [Android ç»„ä»¶åŒ– ARouter](../8abe118f14be78884377a6dfc907d6cf95994120)
  - [Android ç»„ä»¶åŒ–åŸºç¡€](../3b4772e22e0b7c32dd35ae81cbe686a7e7df3307)
{% endpullquote %}