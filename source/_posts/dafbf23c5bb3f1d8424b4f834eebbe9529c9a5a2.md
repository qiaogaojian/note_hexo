---
title: GPU 实时监控工具 nvitop
date: 2024-10-23 15:11:34
categories: ['6.工具', 'AI', '监控']
tags: ['工具', '监控', 'AI']
---

> 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/SlOJZmF08v3-6o6rXWIHaQ)

![](https://mmbiz.qpic.cn/mmbiz_png/oAH7GxxkX4qI7iaeTpaq6GnL2eXOic81xfPEyzGhqefZpbicPgUfn8vgDbXhqBYqQaB9ylK0KZ7uCnpnkz1HtgxMA/640?wx_fmt=png)

github 地址: https://github.com/XuehaiPan/nvitop
  
  
## 引言 8

相信大家在用 NVIDIA-GPU 训练网络模型的时候，都会习惯性的在终端`nvidia-smi`一下吧？最直接的目的是为了查看哪些卡正在使用，哪些卡处在空闲，然后挑选空闲的卡号进行网络训练。

**「了解哪块卡处在空闲只是普通算法工程师的普通需求」**

咱们作为一名资深的算法工程师，毕竟身兼多职：上要开发 AI 算法，下要管理服务器，左要带新人，右要 PPT 汇报上级。

对于管理服务器：刚买的新服务器你得装系统吧？得装`Driver`，`Cuda`，`Cudnn`吧？时不时还得盯一下服务器各个卡的运行状况，毕竟刚入职的小年青有时候一顿操作，一个人占用全服务器 95% 以上的内存把服务器直接卡死也不是没有可能。

`nvitop`是一个非常全面的 NVIDIA-GPU 设备运行状况的实时监控工具，它将 GPU 利用率，显存占比，卡号使用者，CPU 利用率，进程使用时间，命令行等等集于一身，并以差异化的颜色进行个性化展示，安装过程也非常简单，强烈大家推荐使用，让自己在管理服务器的时候事半功倍！

以下图 1 展示了`nvitop`和`nvidia-smi`命令的界面对比结果：

![](https://mmbiz.qpic.cn/mmbiz_png/oAH7GxxkX4oiapfe7dgr7JRYVRCvR3JKFf4jX1JDbK3BYK9oJicn2jRTKYtZTjjnegFxfcQWMfILx5rB7W6gYicJQ/640?wx_fmt=png)图 1. nvitop(左) VS nvidia-smi(右)
  
  
## nvitop 效果展示

> **「NviTop」** An interactive NVIDIA-GPU process viewer and beyond, the one-stop solution for GPU process management.

`nvitop`是一款交互式 NVIDIA-GPU 设备性能 & 资源 & 进程的实时监测工具。

相比于`nvidia-smi`命令，`nvitop`在实时监控 GPU 设备资源 & 性能上具备全方位优势：

*   以更美观的颜色，和更直观的进度条实时展示某块 GPU 卡所处进程的 GPU&CPU 内存以及利用率占比    
*   作为资源监控器，它包括如下功能：树状视图、环境变量查看、进程过滤、进程指标检测等    
*   可追踪某个单项进程在 GPU&CPU 上内存和利用率占比的历史纪录，并利用 Bar 直观展示    
*   可直观展示某块 GPU 的使用者、使用时间、使用命令行、GPU 和 CPU 占用率记录    
*   可使用工具提供的 API 搭建自定义监控工具    

完整 API 说明文档请移步：https://nvitop.readthedocs.io

以下展示了 nvitop 命令工具的部分效果图：![](https://mmbiz.qpic.cn/mmbiz_png/oAH7GxxkX4oiapfe7dgr7JRYVRCvR3JKFdP5kBEJGIyxTbRGCiaNLpft6tQW4efOFxbEicgNeXbkQ5szypAGfibd2A/640?wx_fmt=png)图 2. nvitop 有多种监控模式可供选择![](https://mmbiz.qpic.cn/mmbiz_png/oAH7GxxkX4oiapfe7dgr7JRYVRCvR3JKFY6Z9XDFkzpDLP8jW53EtJbMxiaiaNV4fn1EkozeibmeSb6w28JpUgibF8g/640?wx_fmt=png)图 3. 监控过程信息过滤和丰富的色彩界面![](https://mmbiz.qpic.cn/mmbiz_png/oAH7GxxkX4oiapfe7dgr7JRYVRCvR3JKFkibtApLHIcO4rUUeMS4H6n6Kp1nKTbPMuoSUEr4zwKIGCl3xq7vfiboQ/640?wx_fmt=png)图 4. 支持 MIG![](https://mmbiz.qpic.cn/mmbiz_png/oAH7GxxkX4oiapfe7dgr7JRYVRCvR3JKFJj8YajmmpFLib9dNqVSAsrYY58DgBOFZQlUQtry4jluKnI85LQEQuaw/640?wx_fmt=png) 图 5. 类似频谱的条形图 (with option --colorful)![](https://mmbiz.qpic.cn/mmbiz_png/oAH7GxxkX4oiapfe7dgr7JRYVRCvR3JKFJeIR6QNVqrMWmnsjElsXyKAgBSKPoicXkVEExeovz8TOU65TXNHdqLQ/640?wx_fmt=png) 图 6. 监控特定进程的关键性性能指标 (shortcut: Enter / Return).![](https://mmbiz.qpic.cn/mmbiz_png/oAH7GxxkX4oiapfe7dgr7JRYVRCvR3JKFE0z7fOPibGibZ3HTFNtiaayicwZOl1kzFpBBNvcVfv2nwGlJjL3FpCejRg/640?wx_fmt=png) 图 7. nvitop 同时也支持 windows 系统!
  
  
## nvitop 特性

  
  
### 监控信息丰富且展示直观

显示比`nvidia-smi`更全面的资源监控信息，和更直观的表现形式
  
  
### 监控模式

可以作为资源监控器一直运行，而不是只能单独查看一次结果

*   支持条形图和历史图    
*   监控信息排序 & 监控信息过滤    
*   可通过键盘向进程发送信号    
*   GPU 进程及其父进程的树视图屏幕享受    
*   提供环境变量屏幕，帮助信息屏幕，并支持鼠标点击的交互式操作    
  
  
### 交互式

可在监控模式下响应用户输入（来自键盘或鼠标），比`gpustat`和`py3nvml`更具优势
  
  
### 高效性

*   该工具直接使用`NVML Python bindings`进行绑定并查询设备运行状态，而不是解析`nvidia-smi`（与`nvidia-htop`相比）    
*   `TTLCache`使用 from `cachetools`支持稀疏查询和缓存结果（与`py3nvml`相比）    
*   `curses`使用库而不是`print`ANSI 转义码显示信息（与`py3nvml`相比）    
*   使用多线程异步收集信息并更快的响应用户输入（与`nvtop`相比）    
  
  
### 便携性

适用于`Linux`和`Windows`

*   使用跨平台库`psutil`获取主机进程信息，而不是调用`ps -p <pid>`子进程（与`nvidia-htop`和`py3nvml`相比）    
*   用纯`Python`编写，支持`pip`安装（与`nvtop`相比）    
  
  
### 可集成

易于集成到其它应用程序中，而不仅仅是监控功能（与`nvidia-htop`和`nvtop`相比）
  
  
## 安装指南

> **「官方安装教程」** https://github.com/XuehaiPan/nvitop/blob/main/README.md

因为`nvitop`采用纯`Python`编写，所以推荐采用`pip`命令进行安装：
```python
pip install nvitop
```
  
  
## 使用方法

  
  
### 命令行使用方法

```python
# Monitor mode (when the display mode is omitted, `NVITOP_MONITOR_MODE` will be used)  
$ nvitop  # or use `python3 -m nvitop`  
  
# Automatically configure the display mode according to the terminal size  
$ nvitop -m auto     # shortcut: `a` key  
  
# Arbitrarily display as `full` mode  
$ nvitop -m full     # shortcut: `f` key  
  
# Arbitrarily display as `compact` mode  
$ nvitop -m compact  # shortcut: `c` key  
  
# Specify query devices (by integer indices)  
$ nvitop -o 0 1  # only show <GPU 0> and <GPU 1>  
  
# Only show devices in `CUDA_VISIBLE_DEVICES` (by integer indices or UUID strings)  
$ nvitop -ov  
  
# Only show GPU processes with the compute context (type: 'C' or 'C+G')  
$ nvitop -c  
  
# Use ASCII characters only  
$ nvitop -U  # useful for terminals without Unicode support  
  
# For light terminals  
$ nvitop --light  
  
# For spectrum-like bar charts (requires the terminal supports 256-color)  
$ nvitop --colorful
```
  
  
### 将监控信息写入到 TensorBoard 中

```python
import os  
  
import torch  
import torch.nn as nn  
import torch.nn.functional as F  
from torch.utils.tensorboard import SummaryWriter  
  
from nvitop import CudaDevice, ResourceMetricCollector  
from nvitop.callbacks.tensorboard import add_scalar_dict  
  
# Build networks and prepare datasets  
...  
  
# Logger and status collector  
writer = SummaryWriter()  
collector = ResourceMetricCollector(devices=CudaDevice.all(),  # log all visible CUDA devices and use the CUDA ordinal  
                                    root_pids={os.getpid()},   # only log the descendant processes of the current process  
                                    interval=1.0)              # snapshot interval for background daemon thread  
  
# Start training  
global_step = 0  
for epoch in range(num_epoch):  
    with collector(tag='train'):  
        for batch in train_dataset:  
            with collector(tag='batch'):  
                metrics = train(net, batch)  
                global_step += 1  
                add_scalar_dict(writer, 'train', metrics, global_step=global_step)  
                add_scalar_dict(writer, 'resources',      # tag='resources/train/batch/...'  
                                collector.collect(),  
                                global_step=global_step)  
  
        add_scalar_dict(writer, 'resources',              # tag='resources/train/...'  
                        collector.collect(),  
                        global_step=epoch)  
  
    with collector(tag='validate'):  
        metrics = validate(net, validation_dataset)  
        add_scalar_dict(writer, 'validate', metrics, global_step=epoch)  
        add_scalar_dict(writer, 'resources',              # tag='resources/validate/...'  
                        collector.collect(),  
                        global_step=epoch)
```
  
  
### API 使用手册

**「详见」** https://nvitop.readthedocs.io/


**相关笔记:**

- [GPU 实时监控工具 nvtop](../77451a76ae1222084a1d5bf6efd199dc659c54c0)

{% pullquote mindmap mindmap-md %}
- 🔵
  - [GPU 实时监控工具 nvtop](../77451a76ae1222084a1d5bf6efd199dc659c54c0)
{% endpullquote %}