---
title: MySQL 常用命令
date: 2023-01-31 17:18:06
categories: ['5.技能', 'Server', 'MySql']
tags: ['sql', 'srcard', 'mysql']
---
  
  
## SQL的概念

SQL 是结构化查询语言,是what型语音,而非how型语言, SQL代码按照作用可以分为以下三种  
  
- **dml** 数据库<mark style="background: #fefe00A6;">操作</mark> 语言 (**使用者**角度,增删改查,占<mark style="background: #be9affA6;">80%</mark> ) 这80%当中,查询又占<mark style="background: #be9affA6;">80%</mark> 
- **ddl** 数据库<mark style="background: #fefe00A6;">定义</mark> 语言 (**创建者**角度,建表,建库,建视图,<mark style="background: #be9affA6;">15%</mark> )
- **dcl** 数据库<mark style="background: #fefe00A6;">控制</mark> 语言 (**管理员**角度,DBA,<mark style="background: #be9affA6;">5%</mark> )
<!--SR:!2024-12-06,403,250-->
  
  
## DDL 数据库定义语言

建表就是声明表头的过程
  
  
### 数值型

**整型数值范围**
  
|类型|字节数|范围|
|---|---|---:|
|tinyint| 1-8位|+-128|
|smallint| 2-16位|+-32, 768|
|mediumint| 3-24位|+-8, 388, 608|
|int| 4-32位|+-2, 147, 483, 648|
|bigint| 8-64位|+-9, 223, 372, 036, 854, 775, 808|
  
**可选参数**
- unsigned 无符号
- zerofill(M) 固定宽度M 填充0 (隐含附带 unsigned 属性)
<!--SR:!2024-12-05,400,250-->
  
  
### 浮点

会有精度损失
- float
- double
  
  
### 定点

没有精度损失
- decimal

`[M,D]` M:位数 D:精度
  
  
### 字符串

  
| 类型 | 特点 |
| --# | --# |
| char    |      定长 速度快|
| varchar |          不定长 速度慢|
| blob    |       二进制 防止字符集过滤信息丢失|
| enum    |       固定的几个值|
  
**字符字节数**
| 编码  | 英文字母 | 中文汉字 | 标点符号 |
| ---# | ------# | ------# | ------# |
| GBK   | 1        | 2        | 1        | 
| UTF-8 | 1        | 3        | 1        |
<!--SR:!2026-06-13,737,250-->
  
  
### 日期时间

- year
- date
- time
- datetime
- timestamp
  
  
### 默认值

- not null default 'value'
- primary key
- auto increment
  
  
### 类型取值范围汇总

  
|类 型|大 小|描 述|
|---|---|---|
|CAHR(Length)|Length字节|定长字段，长度为0~255个字符|
|VARCHAR(Length)|String长度:1字节或String长度:2字节|变长字段，长度为0~65 535个字符|
| TINYTEXT|String长度:1字节|字符串，最大长度为255个字符|
| TEXT|String长度:2字节|字符串，最大长度为65 535个字符|
| MEDIUMTEXT|String长度:3字节|字符串，最大长度为16 777 215个字符|
| LONGTEXT|String长度:4字节|字符串，最大长度为4 294 967 295个字符|
| TINYINT(Length)|1字节|范围：-128~127，或者0~255（无符号）|
| SMALLINT(Length)|2字节|范围：-32 768~32 767，或者0~65 535（无符号）|
| MEDIUMINT(Length)|3字节|范围：-8 388 608~8 388 607，或者0~16 777 215（无符号）|
| INT(Length)|4字节|范围：-2 147 483 648~2 147 483 647，或者0~4 294 967 295（无符号）|
| BIGINT(Length)|8字节|范围：-9 223 372 036 854 775 808~9 223 372 036 854 775 807，或者0~18  446 744 073 709 551 615（无符号）|
| FLOAT(Length, Decimals)|4字节|具有浮动小数点的较小的数|
| DOUBLE(Length, Decimals)|8字节|具有浮动小数点的较大的数|
| DECIMAL(Length, Decimals)|Length:1字节或Length:2字节|存储为字符串的DOUBLE，允许固定的小数点|
| DATE|3字节|采用YYYY-MM-DD格式|
| DATETIME|8字节|采用YYYY-MM-DD HH:MM:SS格式|
| TIMESTAMP|4字节|采用YYYYMMDDHHMMSS格式；可接受的范围终止于2037年|
| TIME|3字节|采用HH:MM:SS格式|
| ENUM|1或2字节|Enumeration(枚举)的简写，这意味着每一列都可以具有多个可能的值之一|
| SET|1、2、3、4或8字节|与ENUM一样，只不过每一列都可以具有多个可能的值|
<!--SR:!2024-09-14,208,230-->
  
  
### 存储引擎的区别

  
|特点|MyIsam|InnoDB|Memory|
|---|---|---|---|
|批量插入速度|高|低|高|
|事务||支持||
|全文索引|支持|||
|锁机制|表锁|行锁||
|存储限制|没有|64TB||
<!--SR:!2024-08-21,345,250-->
  
  
### 字符集

数据表设置 **charset**
```mysql
mysql> show variables like '%charact%';
mysql> set names utf8;
```

- 字符集选 `utf8` 
- 排序规则选 `utf8_general_ci`
  
  
### 索引

索引是一种树形结构
提高了查的速度 减慢了增删改的速度 一般在查询频繁高和重复率低的列加索引
- primary key 主键索引
- index 普通索引
- unique index 唯一性索引
- fulltext index 全文索引 全文索引中文无效 一般用分词+索引 如sphinx
```mysql
create table test
(
    id int,
    name char(10),
    email char(20),
    primary key(id),
    key name(name),
    unique key email(email)
);

# 索引长度
key email(emial(10)) # 取前10个字符作为索引 为了把重复的内容剔除

# 多列索引
create table name
(
    xing char(2),
    ming char(10),
    key xm(xing,ming)
);
# 左前缀: 0 两个 第一次 索引生效  只有第二个无效
explain select * from name where xing = "michael" \G;

# 冗余索引 被多个覆盖
key xm(xing,ming),
key m(ming)
```
  
  
### 事务

事务 要么都完成 要么都失败, 具有以下特点
- 隔离性
- 原子性
- 一致性
- 持久性
需要使用引擎: **innodb**
流程:
```mysql
开启事务          start transaction
运行sql
提交,同时生效\回滚 commit\rollback
```
  
  
### 触发器 trigger

- 监视地点:表
- 监视行为:增 删 改
- 触发时间:after\before
- 触发事件:增 删 改

创建触发器语法
```mysql
create trigger tgName
after/before insert/delete/update
on tableName
for each row
sql; # 触发语句
```

删除触发器:
```mysql
drop trigger tgName;
```
  
  
### 优化

- 定长不定长分离
- 常用不常用分离
  
  
## SQL 语句

  
  
### 连接数据库

  
```mysql
$ mysql -h localhost -u root -p

# 查看数据库状态
mysql> status;
--------------
D:\xampp\MySQL\bin\mysql.exe  Ver 14.14 Distrib 5.5.47, for Win32 (x86)

Connection id:          3
Current database:       test
Current user:           root@localhost
SSL:                    Not in use
Using delimiter:        ;
Server version:         5.5.47 MySQL Community Server (GPL)
Protocol version:       10
Connection:             localhost via TCP/IP
Server characterset:    utf8
Db     characterset:    latin1
Client characterset:    gbk
Conn.  characterset:    gbk
TCP port:               3306
Uptime:                 8 hours 13 min 28 sec

Threads: 1  Questions: 171  Slow queries: 0  Opens: 78  Flush tables: 1  Open tables: 0  Queries per second avg: 0.005
--------------
```
<!--SR:!2025-12-18,631,250-->
  
  
### 建表

  
```mysql
mysql> CREATE TABLE tem
    -> (
    -> id int,
    -> name varchar(20)
    -> )charset utf8;
Query OK, 0 rows affected (0.01 sec)

mysql> INSERT INTO tem VALUES
    -> (1,"Michael"),
    -> (2,null);
Query OK, 2 rows affected (0.00 sec)
Records: 2  Duplicates: 0  Warnings: 0

mysql> SELECT * FROM tem;
+------+---------+
| id   | name    |
+------+---------+
|    1 | Michael |
|    2 | NULL    |
+------+---------+
2 rows in set (0.00 sec)
```
<!--SR:!2025-03-20,478,250-->
  
  
### 选择表

  
```mysql
# 显示所有数据库
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| client             |
| messageboard       |
| my_db              |
| mysql              |
| performance_schema |
| test               |
| unitypackage       |
+--------------------+
8 rows in set (0.01 sec)

# 打开 test 数据库
mysql> use test
Database changed

# 显示 test 数据库所有的表
mysql> show tables;
+----------------+
| Tables_in_test |
+----------------+
| a              |
| b              |
| boy            |
| category       |
| girl           |
| goods          |
| m              |
| mian           |
| result         |
| t              |
| user           |
+----------------+
11 rows in set (0.00 sec)
```
<!--SR:!2026-04-29,710,250-->
  
  
### 查看表结构

  
```mysql
mysql> desc user;
+-------+----------------------+------+-----+---------+----------------+
| Field | Type                 | Null | Key | Default | Extra          |
+-------+----------------------+------+-----+---------+----------------+
| uid   | int(11)              | NO   | PRI | NULL    | auto_increment |
| name  | varchar(20)          | NO   |     |         |                |
| age   | smallint(5) unsigned | NO   |     | 0       |                |
+-------+----------------------+------+-----+---------+----------------+
3 rows in set (0.02 sec)
# null 属于比较特殊的类型,不能用 = 号,要用 is, 一般来说 为了方便管理 一个字段的值不能为 null

mysql> show create table user;
```
<!--SR:!2026-01-18,650,250-->
  
  
### 表管理

  
```mysql
# 表的详细信息
mysql> show table status \G;

# 表的详细信息
mysql> show table status where name = "user" \G;

# 清空表
mysql> truncate  # 相当于 drop + create
mysql> delete    # 相当于删除表数据

# 重命名表
rename table user to userhack
```
<!--SR:!2024-11-01,388,250-->
  
  
### 数据的备份和恢复

  
备份与恢复
系统运行中, 增量备份,与整体备份.
例: 每周日整体备份一次, 周一到周六备份当天.
如果周五出了问题,可以用周日的整体 + 周一,二,三,四来恢复.
备份的工具
有第3方的收费备份工作,
目前我们所学的是系统自带的备份功能, mysqldump
Mysqldump可以导出 **库** 和 **表** 
导出的是建表语句及insert语句
<!--SR:!2024-11-13,395,250-->
  
  
##### 导出

- **例1: 导出库下面的表**
`Mysqldump -u用户名 -p密码 库名 表1 表2 表3 > 地址/备份文件名称`
- **例2:导出一个库下面的所有表**
`Mysqldump -u用户名 -p密码 库名 > 地址/备份文件名称`
- **例3: 以库为单位导出**
`Mysqldump -u用户名 -p密码 -B 库1 库2 库3 > 地址/备份文件名称`
- **例4: 如何导出所有库**
`Mysqldump -u用户名 -p密码 -A > 地址/备份文件名称`
  
  
##### 恢复

1. **不登陆到mysql命令行**
- 针对表级的备份文件
`Mysql -u用户名 -p密码 库名 < 表级备份文件地址`
- 针对库级的备份文件
`Mysql -u用户名 -p密码 < 库级备份文件地址`

2. **登陆到mysql命令行**
- 对于表级的备份文件
`Mysql > use 库名`
`Mysql> source 备份文件地址`
- 对于库级的备份文件
`Mysql> source 备份文件地址`
  
  
### 插入数据 INSERT INTO

  
```mysql
# 插入单条数据
# INSERT INTO 要插入的表 (字段1,字段1) VALUES (字段1的值,字段2的值);
mysql> INSERT INTO user (uid,name) VALUES (2,"Michael");
Query OK, 1 row affected (0.00 sec)

# 插入多条数据
mysql> INSERT INTO user VALUES
    -> (3,"张三",20), # 列与值, 严格对应
    -> (4,"李四",21), # 数字不必加引号,字符串必须加引号
    -> (5,"王五",22);  
Query OK, 3 rows affected (0.00 sec)
Records: 3  Duplicates: 0  Warnings: 0

mysql> SELECT * FROM user;
+-----+--------+-----+
| uid | name   | age |
+-----+--------+-----+
|   1 | gaojian|  25 |
|   2 | 迈克尔 |  19 |
|   3 | 张三   |  20 |
|   4 | 李四   |  21 |
|   5 | 王五   |  22 |
+-----+--------+-----+
5 rows in set (0.00 sec)
```
<!--SR:!2026-02-07,662,250-->
  
  
### 删除数据 DELETE FROM

  
```mysql
# DELETE FROM 所在的表 WHERE 要删除行
mysql> delete FROM user WHERE uid=3;
Query OK, 1 row affected (0.00 sec)

mysql> SELECT * FROM user;
+-----+--------+-----+
| uid | name   | age |
+-----+--------+-----+
|   1 | gaojian|  25 |
|   2 | 迈克尔 |  19 |
+-----+--------+-----+
2 rows in set (0.00 sec)
```
<!--SR:!2026-08-04,770,250-->
  
  
### 更改数据 UPDATE SET

  
```mysql
# UPDATE 改哪张表 SET 你要改哪几列的值 WHERE 在哪些行生效 
mysql> UPDATE user SET age=18, uid=2 WHERE name="Michael"; # 更新多个属性时记得加逗号',' 属性的顺序和表结构保持一致
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> SELECT * FROM user;
+-----+----------+-----+
| uid | name     | age |
+-----+----------+-----+
|   1 | gaojian  |  25 |
|   2 | Michael  |  18 |
|   3 | Michelle |  26 |
+-----+----------+-----+
3 rows in set (0.00 sec)
```
<!--SR:!2026-11-19,843,250-->
  
  
### 查询数据 SELECT FROM

  
```mysql
# 查询所有字段
mysql> SELECT * FROM user;
+-----+--------+-----+
| uid | name   | age |
+-----+--------+-----+
|   1 | gaojian|  25 |
+-----+--------+-----+
1 row in set (0.00 sec)

# 查询特殊字段
# SELECT 要查询的列 FROM 所在的表 WHERE 要查询的行
mysql>  SELECT uid,name FROM user WHERE uid>=3;
+-----+------+
| uid | name |
+-----+------+
|   3 | 张三 |
|   4 | 李四 |
|   5 | 王五 |
+-----+------+
3 rows in set (0.00 sec)
```
**常见错误:**
以下五种子查询的顺序是固定的不可改变的
where, group by, having, order by, limit
<!--SR:!2024-09-23,361,250-->
  
  
### 子查询

  
```mysql
# where 子句
mysql> SELECT * FROM goods WHERE goods_id=(SELECT max(goods_id) FROM goods);
+----------+------------+--------+----------+-----------+--------------+------------+--------------+-------------+
| goods_id | goods_name | cat_id | brand_id | goods_sn  | goods_number | shop_price | market_price | click_count |
+----------+------------+--------+----------+-----------+--------------+------------+--------------+-------------+
|       32 | 诺基亚Cn85 |      3 |        1 | ecs000032 |            4 |    3010.00 |      3612.00 |           9 |
+----------+------------+--------+----------+-----------+--------------+------------+--------------+-------------+
1 row in set (0.00 sec)

# from 子句
select * from (select * from goods order by cat_id asc,goods_id desc) as tem group by cat_id order by goods_id;

# exists 子句
select * from category where exists (select * from goods where goods.cat_id=category.cat_id);
```
<!--SR:!2025-02-27,467,250-->
  
  
### 模糊查询

  
```mysql
# 多个字符 %
mysql> select * from goods where goods_name like "诺基亚%";

# 单个字符 _
mysql> select * from goods where goods_name like "诺基亚N__";
```
<!--SR:!2025-02-26,467,250-->
  
  
### 排序

  
```mysql
# 排序 多层排序
mysql> select goods_id,goods_name,cat_id,shop_price from goods order by cat_id,shop_price desc;

# asc  升序
# desc 降序
```
<!--SR:!2024-12-01,405,250-->
  
  
### 截取

  
```mysql
# 一个结果集获得之后 有选择性的选择一部分结果  有两个参数 offset,range
mysql> select * from goods order by shop_price desc limit 3;
# 这个才是常规的写法
mysql> select * from goods order by shop_price desc limit 2,3;

mysql> select * from goods order by goods_id desc limit 0,1;
```
<!--SR:!2024-10-15,379,250-->
  
  
### 连接

  
```mysql
# 内连
mysql> SELECT boy.hid,boy.bname,girl.gname
    -> FROM boy INNER JOIN girl
    -> ON boy.hid=girl.hid;
+------+--------+--------+
| hid  | bname  | gname  |
+------+--------+--------+
| B    | 杨过   | 小龙女 |
| C    | 陈冠希 | 张柏芝 |
+------+--------+--------+
2 rows in set (0.00 sec)

# 左连
mysql> SELECT boy.hid,boy.bname,girl.gname
    -> FROM boy LEFT JOIN girl
    -> ON boy.hid=girl.hid;
+------+--------+--------+
| hid  | bname  | gname  |
+------+--------+--------+
| A    | 屌丝   | NULL   |
| B    | 杨过   | 小龙女 |
| C    | 陈冠希 | 张柏芝 |
+------+--------+--------+
3 rows in set (0.00 sec)

# 右连
mysql> SELECT boy.hid,boy.bname,girl.gname
    -> FROM boy RIGHT JOIN girl
    -> ON boy.hid = girl.hid;
+------+--------+--------+
| hid  | bname  | gname  |
+------+--------+--------+
| B    | 杨过   | 小龙女 |
| C    | 陈冠希 | 张柏芝 |
| NULL | NULL   | 死宅女 |
+------+--------+--------+
3 rows in set (0.00 sec)

# 外连
mysql> SELECT boy.hid,boy.bname,girl.gname
    -> FROM boy FULL OUTER JOIN girl
    -> ON boy.hid = girl.hid;
+------+--------+--------+
| hid  | bname  | gname  |
+------+--------+--------+
| A    | 屌丝   | NULL   |
| B    | 杨过   | 小龙女 |
| C    | 陈冠希 | 张柏芝 |
| NULL | NULL   | 死宅女 |
+------+--------+--------+
3 rows in set (0.00 sec)
```
<!--SR:!2024-11-10,387,250-->
  
  
### 常用函数

  
```mysql
# count
mysql> SELECT count(*) FROM goods;
+----------+
| count(*) |
+----------+
|       31 |
+----------+
1 row in set (0.00 sec)

# replace 
mysql> UPDATE goods
    -> SET goods_name= replace(goods_name, '诺基亚', 'HTC')
    -> WHERE goods_name LIKE '诺基亚%';
Query OK, 8 rows affected (0.00 sec)
Rows matched: 8  Changed: 8  Warnings: 0

# max
mysql> SELECT max(goods_id) FROM goods;
+---------------+
| max(goods_id) |
+---------------+
|            32 |
+---------------+
1 row in set (0.00 sec)

# min
mysql> SELECT min(goods_id) FROM goods;
+---------------+
| min(goods_id) |
+---------------+
|             1 |
+---------------+
1 row in set (0.00 sec)

# sum
mysql> SELECT sum(goods_number) FROM goods;
+-------------------+
| sum(goods_number) |
+-------------------+
|               313 |
+-------------------+
1 row in set (0.00 sec)

# avg
mysql> SELECT avg(shop_price) FROM goods;
+-----------------+
| avg(shop_price) |
+-----------------+
|     1232.526774 |
+-----------------+
1 row in set (0.00 sec)
```
<!--SR:!2026-09-19,800,250-->

